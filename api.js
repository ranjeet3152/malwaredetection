var express = require('express');
var app = express();
var con = require('./connection');

module.exports = function(app){
app.get('/urlinfo/1/:host/:port', function(req, res){
    host = req.params.host;
    port = req.params.port;
  //  path = req.query.original_path;
    //queryString = req.query.query_string;
    sql_query = "SELECT id FROM malwareurl where host = \"" + host + "\" and port = " + port ;
    console.log(sql_query);
    con.query(sql_query ,function (error, results, fields) {
  //con.query("SELECT id FROM malwareurl where host = 'www.google.com' and port = 2000 and path = '/url/1' and queryString = 'q=name,s=age'" ,function (error, results, fields) {
        console.log(results);
        if(results.length <= 0){
          res.send("Safe to access");
        }
        else{
          res.send("Unsafe!! Don't proceed ");
        }
        //res.send(results);
        if(error){
        console.log(error);
    }     
  //  res.send({hostname_and_port, original_path_and_query_string});
});
});
}
